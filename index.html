<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Gerador de Curr√≠culo Profissional - üêçProPythonLabüêç</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Estilos locais -->
    <link rel="stylesheet" href="static/css/style.css" />

    <!-- PyScript / Pyodide -->
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>

    <!-- jsPDF para gera√ß√£o de PDF no navegador -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div class="container">
    <h1>Gerador de Curr√≠culo Profissional - üêçProPythonLabüêç</h1>
    <form id="cv-form" class="resume-form">
        <h2>1. Dados pessoais</h2>
        <div class="grid-2">
            <label>Nome completo
                <input type="text" name="nome" required maxlength="120" />
            </label>
            <label>Profiss√£o / T√≠tulo principal
                <input type="text" name="titulo" required maxlength="120" placeholder="Ex: Desenvolvedor Python, Analista de Dados, Auxiliar Administrativo Hospitalar" />
            </label>
        </div>
        <div class="grid-3">
            <label>E-mail
                <input type="email" name="email" required maxlength="120" />
            </label>
            <label>Telefone
                <input type="text" name="telefone" required maxlength="40" />
            </label>
            <label>Endere√ßo (opcional)
                <input type="text" name="endereco" maxlength="160" />
            </label>
        </div>
        <div class="grid-3">
            <label>Link para portf√≥lio / GitHub / LinkedIn (opcional)
                <input type="url" name="link_portfolio" maxlength="200" placeholder="https://github.com/seu_usuario" />
            </label>
            <label>URL da foto profissional (opcional)
                <input type="url" name="foto_url" maxlength="200" placeholder="https://..." />
            </label>
        </div>

        <h2>2. Resumo profissional</h2>
        <label>Sobre mim (at√© 1000 caracteres)
            <textarea name="resumo" rows="5" maxlength="1000" placeholder="Quem √© voc√™ profissionalmente, principais for√ßas, resultados relevantes e objetivo atual."></textarea>
        </label>

        <h3>An√°lise de vaga (opcional)</h3>
        <label>URL da vaga (somente informativa neste modo est√°tico)
            <input type="url" name="job_url" maxlength="300" placeholder="https://..." />
        </label>

        <h2>3. Experi√™ncia profissional</h2>
        <div id="experiencias-container">
            <div class="experiencia-item">
                <div class="grid-2">
                    <label>Nome da empresa
                        <input type="text" name="exp_empresa" maxlength="120" />
                    </label>
                    <label>Cargo ocupado
                        <input type="text" name="exp_cargo" maxlength="120" />
                    </label>
                </div>
                <div class="grid-3">
                    <label>Per√≠odo
                        <input type="text" name="exp_periodo" maxlength="80" placeholder="Ex: Jan/2022 ‚Äî Atual" />
                    </label>
                    <label>Localiza√ß√£o (opcional)
                        <input type="text" name="exp_local" maxlength="80" placeholder="Ex: S√£o Paulo - SP / Remoto" />
                    </label>
                </div>
                <label>Descri√ß√£o das atividades
                    <textarea name="exp_descricao" rows="3" maxlength="1500" placeholder="Principais atividades exercidas na fun√ß√£o."></textarea>
                </label>
                <label>Principais conquistas (bullets separados por ponto e v√≠rgula)
                    <textarea name="exp_conquistas" rows="3" maxlength="1500" placeholder="Lideran√ßa em projetos de automa√ß√£o; Redu√ß√£o de custos em 35%; Implementa√ß√£o de testes automatizados..."></textarea>
                </label>
                <label>Tecnologias usadas (opcional, separadas por v√≠rgula)
                    <textarea name="exp_tech" rows="2" maxlength="500" placeholder="Python, Flask, FastAPI, Docker, PostgreSQL..."></textarea>
                </label>
            </div>
        </div>
        <button type="button" class="btn-secondary" id="add-experiencia">‚ûï Adicionar experi√™ncia</button>

        <h2>4. Forma√ß√£o / Educa√ß√£o</h2>
        <div id="formacoes-container">
            <div class="experiencia-item">
                <div class="grid-2">
                    <label>Nome do curso
                        <input type="text" name="edu_curso" maxlength="160" />
                    </label>
                    <label>Institui√ß√£o
                        <input type="text" name="edu_inst" maxlength="160" />
                    </label>
                </div>
                <div class="grid-3">
                    <label>Cidade / Pa√≠s (opcional)
                        <input type="text" name="edu_cidade" maxlength="120" />
                    </label>
                    <label>Ano de conclus√£o
                        <input type="text" name="edu_ano" maxlength="10" placeholder="Ex: 2024" />
                    </label>
                    <label>Situa√ß√£o (opcional)
                        <input type="text" name="edu_status" maxlength="40" placeholder="Conclu√≠do, Cursando, Trancado" />
                    </label>
                </div>
            </div>
        </div>
        <button type="button" class="btn-secondary" id="add-formacao">‚ûï Adicionar forma√ß√£o</button>

        <h2>5. Habilidades</h2>
        <label>Habilidades t√©cnicas (separadas por v√≠rgulas)
            <textarea name="skills_tecnicas" rows="2" maxlength="1000" placeholder="Python, SQL, HTML/CSS, Power BI, FastAPI, Git, Linux..."></textarea>
        </label>
        <label>Habilidades comportamentais (separadas por v√≠rgulas)
            <textarea name="skills_comportamentais" rows="2" maxlength="1000" placeholder="Comunica√ß√£o, Trabalho em equipe, Organiza√ß√£o, Proatividade..."></textarea>
        </label>
        <label>Outras habilidades / ferramentas
            <textarea name="skills_outras" rows="2" maxlength="1000" placeholder="Ingl√™s intermedi√°rio, Pacote Office, Notion, Jira..."></textarea>
        </label>

        <h2>6. Certifica√ß√µes</h2>
        <div id="certificacoes-container">
            <div class="experiencia-item">
                <div class="grid-3">
                    <label>Nome da certifica√ß√£o
                        <input type="text" name="cert_nome" maxlength="160" />
                    </label>
                    <label>Institui√ß√£o emissora
                        <input type="text" name="cert_inst" maxlength="160" />
                    </label>
                    <label>Ano
                        <input type="text" name="cert_ano" maxlength="10" />
                    </label>
                </div>
                <label>C√≥digo de verifica√ß√£o (opcional)
                    <input type="text" name="cert_codigo" maxlength="80" />
                </label>
            </div>
        </div>
        <button type="button" class="btn-secondary" id="add-cert">‚ûï Adicionar certifica√ß√£o</button>

        <h2>7. Projetos</h2>
        <div id="projetos-container">
            <div class="experiencia-item">
                <label>Nome do projeto
                    <input type="text" name="proj_nome" maxlength="160" />
                </label>
                <label>Tecnologias
                    <textarea name="proj_tec" rows="2" maxlength="500" placeholder="Python, Flask, React, PostgreSQL..."></textarea>
                </label>
                <label>Descri√ß√£o do impacto
                    <textarea name="proj_desc" rows="3" maxlength="1000" placeholder="Descreva o problema resolvido e o impacto do projeto."></textarea>
                </label>
                <label>Link (GitHub ou demonstra√ß√£o)
                    <input type="url" name="proj_link" maxlength="200" />
                </label>
            </div>
        </div>
        <button type="button" class="btn-secondary" id="add-projeto">‚ûï Adicionar projeto</button>

        <h2>8. Idiomas</h2>
        <div id="idiomas-container">
            <div class="experiencia-item">
                <div class="grid-2">
                    <label>Idioma
                        <input type="text" name="idioma_nome" maxlength="80" placeholder="Ingl√™s, Espanhol..." />
                    </label>
                    <label>N√≠vel
                        <input type="text" name="idioma_nivel" maxlength="80" placeholder="B√°sico, Intermedi√°rio, Avan√ßado, Fluente" />
                    </label>
                </div>
            </div>
        </div>
        <button type="button" class="btn-secondary" id="add-idioma">‚ûï Adicionar idioma</button>

        <h2>9. Cursos / Workshops</h2>
        <div id="cursos-extra-container">
            <div class="experiencia-item">
                <div class="grid-3">
                    <label>Nome do curso / workshop
                        <input type="text" name="curso_extra_nome" maxlength="160" />
                    </label>
                    <label>Carga hor√°ria
                        <input type="text" name="curso_extra_carga" maxlength="40" placeholder="Ex: 20h" />
                    </label>
                    <label>Institui√ß√£o
                        <input type="text" name="curso_extra_inst" maxlength="160" />
                    </label>
                </div>
                <label>Ano
                    <input type="text" name="curso_extra_ano" maxlength="10" />
                </label>
            </div>
        </div>
        <button type="button" class="btn-secondary" id="add-curso-extra">‚ûï Adicionar curso / workshop</button>

        <h2>10. Pr√™mios e reconhecimentos</h2>
        <div id="premios-container">
            <div class="experiencia-item">
                <div class="grid-3">
                    <label>T√≠tulo
                        <input type="text" name="premio_titulo" maxlength="160" />
                    </label>
                    <label>Institui√ß√£o
                        <input type="text" name="premio_inst" maxlength="160" />
                    </label>
                    <label>Ano
                        <input type="text" name="premio_ano" maxlength="10" />
                    </label>
                </div>
                <label>Descri√ß√£o breve
                    <textarea name="premio_desc" rows="2" maxlength="500"></textarea>
                </label>
            </div>
        </div>
        <button type="button" class="btn-secondary" id="add-premio">‚ûï Adicionar pr√™mio</button>

        <h2>11. Voluntariado</h2>
        <div id="voluntariado-container">
            <div class="experiencia-item">
                <div class="grid-2">
                    <label>Organiza√ß√£o
                        <input type="text" name="vol_org" maxlength="160" />
                    </label>
                    <label>Fun√ß√£o
                        <input type="text" name="vol_funcao" maxlength="160" />
                    </label>
                </div>
                <label>Per√≠odo
                    <input type="text" name="vol_periodo" maxlength="80" placeholder="Ex: 2021 ‚Äî 2023" />
                </label>
                <label>Descri√ß√£o
                    <textarea name="vol_desc" rows="3" maxlength="800"></textarea>
                </label>
            </div>
        </div>
        <button type="button" class="btn-secondary" id="add-vol">‚ûï Adicionar voluntariado</button>

        <h2>12. Publica√ß√µes (opcional)</h2>
        <label>Artigos, palestras, papers, links relevantes
            <textarea name="publicacoes" rows="4" maxlength="2000" placeholder="Liste aqui publica√ß√µes, palestras, artigos, blogs ou conte√∫dos relevantes."></textarea>
        </label>

        <h2>13. Exporta√ß√£o</h2>
        <div class="grid-3">
            <label>Formato de sa√≠da
                <select name="output_format">
                    <option value="pdf" selected>PDF</option>
                    <option value="json">JSON (para salvar e carregar depois)</option>
                </select>
            </label>
            <label>Template do PDF
                <select name="template_style">
                    <option value="corporativo" selected>Corporativo</option>
                    <option value="minimalista">Minimalista</option>
                    <option value="ats">ATS-friendly</option>
                </select>
            </label>
        </div>

        <button type="button" id="btn-gerar" class="btn-primary">Gerar curr√≠culo</button>
    </form>
</div>

<script>
    // Clonador b√°sico de blocos din√¢micos (JS puro, sem backend)
    (function () {
        function setupCloner(containerId, buttonId, maxItems) {
            const container = document.getElementById(containerId);
            const button = document.getElementById(buttonId);
            if (!container || !button) return;

            button.addEventListener('click', function () {
                const items = container.getElementsByClassName('experiencia-item');
                if (maxItems && items.length >= maxItems) {
                    alert('Limite m√°ximo de itens atingido.');
                    return;
                }
                const first = items[0];
                const clone = first.cloneNode(true);
                const inputs = clone.querySelectorAll('input, textarea');
                inputs.forEach(function (el) { el.value = ''; });
                container.appendChild(clone);
            });
        }

        setupCloner('experiencias-container', 'add-experiencia', 8);
        setupCloner('formacoes-container', 'add-formacao', 8);
        setupCloner('certificacoes-container', 'add-cert', 8);
        setupCloner('projetos-container', 'add-projeto', 10);
        setupCloner('idiomas-container', 'add-idioma', 10);
        setupCloner('cursos-extra-container', 'add-curso-extra', 10);
        setupCloner('premios-container', 'add-premio', 10);
        setupCloner('voluntariado-container', 'add-vol', 10);
    })();

    // Fun√ß√£o JS que recebe um JSON com os dados do curr√≠culo e gera o PDF via jsPDF
    function gerarPDFFromJson(dataJson) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        const data = JSON.parse(dataJson);

        let y = 15;
        const lineHeight = 6;

        function addLine(text, bold = false) {
            if (!text) return;
            if (y > 280) {
                doc.addPage();
                y = 15;
            }
            doc.setFont('helvetica', bold ? 'bold' : 'normal');
            doc.text(String(text), 10, y);
            y += lineHeight;
        }

        // Cabe√ßalho
        addLine(data.nome || 'Curr√≠culo', true);
        addLine(data.titulo || '', false);
        const contato = [data.email, data.telefone, data.endereco, data.portfolio].filter(Boolean).join(' | ');
        addLine(contato, false);
        y += lineHeight / 2;

        if (data.resumo) {
            addLine('Resumo profissional', true);
            addLine(data.resumo, false);
            y += lineHeight / 2;
        }

        if (Array.isArray(data.experiencias) && data.experiencias.length) {
            addLine('Experi√™ncia profissional', true);
            data.experiencias.forEach(function (e) {
                const titulo = [e.cargo, e.empresa, e.periodo].filter(Boolean).join(' | ');
                addLine(titulo, true);
                if (e.local) addLine(e.local, false);
                if (e.descricao) addLine(e.descricao, false);
                if (e.conquistas) addLine('Conquistas: ' + e.conquistas, false);
                if (e.tecnologias) addLine('Tecnologias: ' + e.tecnologias, false);
                y += lineHeight / 2;
            });
        }

        if (Array.isArray(data.formacoes) && data.formacoes.length) {
            addLine('Forma√ß√£o / Educa√ß√£o', true);
            data.formacoes.forEach(function (f) {
                const titulo = [f.curso, f.instituicao].filter(Boolean).join(' | ');
                const detalhes = [f.cidade, f.ano, f.status].filter(Boolean).join(' | ');
                addLine(titulo, true);
                addLine(detalhes, false);
                y += lineHeight / 2;
            });
        }

        if (data.skills_tecnicas || data.skills_comportamentais || data.skills_outras) {
            addLine('Habilidades', true);
            if (data.skills_tecnicas && data.skills_tecnicas.length) {
                addLine('T√©cnicas: ' + data.skills_tecnicas.join(', '), false);
            }
            if (data.skills_comportamentais && data.skills_comportamentais.length) {
                addLine('Comportamentais: ' + data.skills_comportamentais.join(', '), false);
            }
            if (data.skills_outras && data.skills_outras.length) {
                addLine('Outras: ' + data.skills_outras.join(', '), false);
            }
            y += lineHeight / 2;
        }

        if (Array.isArray(data.certificacoes) && data.certificacoes.length) {
            addLine('Certifica√ß√µes', true);
            data.certificacoes.forEach(function (c) {
                const titulo = [c.nome, c.instituicao, c.ano].filter(Boolean).join(' | ');
                addLine(titulo, true);
                if (c.codigo) addLine('C√≥digo: ' + c.codigo, false);
            });
            y += lineHeight / 2;
        }

        if (Array.isArray(data.projetos) && data.projetos.length) {
            addLine('Projetos', true);
            data.projetos.forEach(function (p) {
                if (p.nome) addLine(p.nome, true);
                if (p.tecnologias) addLine('Tecnologias: ' + p.tecnologias, false);
                if (p.descricao) addLine(p.descricao, false);
                if (p.link) addLine(p.link, false);
                y += lineHeight / 2;
            });
        }

        if (Array.isArray(data.idiomas) && data.idiomas.length) {
            addLine('Idiomas', true);
            data.idiomas.forEach(function (i) {
                const linha = [i.nome, i.nivel].filter(Boolean).join(' - ');
                addLine(linha, false);
            });
            y += lineHeight / 2;
        }

        if (Array.isArray(data.cursos_extra) && data.cursos_extra.length) {
            addLine('Cursos e Workshops', true);
            data.cursos_extra.forEach(function (c) {
                const titulo = [c.nome, c.instituicao].filter(Boolean).join(' | ');
                const detalhes = [c.carga, c.ano].filter(Boolean).join(' | ');
                addLine(titulo, true);
                addLine(detalhes, false);
            });
            y += lineHeight / 2;
        }

        if (Array.isArray(data.premios) && data.premios.length) {
            addLine('Pr√™mios e Reconhecimentos', true);
            data.premios.forEach(function (p) {
                const titulo = [p.titulo, p.instituicao, p.ano].filter(Boolean).join(' | ');
                addLine(titulo, true);
                if (p.descricao) addLine(p.descricao, false);
            });
            y += lineHeight / 2;
        }

        if (Array.isArray(data.voluntariados) && data.voluntariados.length) {
            addLine('Voluntariado', true);
            data.voluntariados.forEach(function (v) {
                const titulo = [v.organizacao, v.funcao, v.periodo].filter(Boolean).join(' | ');
                addLine(titulo, true);
                if (v.descricao) addLine(v.descricao, false);
            });
            y += lineHeight / 2;
        }

        if (data.publicacoes_texto) {
            addLine('Publica√ß√µes', true);
            addLine(data.publicacoes_texto, false);
        }

        const safeName = (data.nome || 'curriculo').toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/_+/g, '_').replace(/^_+|_+$/g, '') || 'curriculo';
        doc.save(`curriculo_${safeName}.pdf`);
    }
</script>

<!-- PyScript: l√≥gica principal em Python, sem backend -->
<py-script src="script.py"></py-script>
</body>
</html>
